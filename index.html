<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>KAIST ID Logo Generator</title>
    <style>
        body {
            font-family: 'Helvetica Neue', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            background-color: #f0f0f0;
            margin: 0;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            gap: 10px;
        }

        input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 180px;
            font-size: 14px;
        }

        .canvas-container {
            background: white;
            padding: 100px;
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
        }

        svg {
            overflow: visible;
        }

        text {
            font-family: 'Helvetica Neue', sans-serif;
            font-weight: normal;
            /* corrected from 'regular' */
            fill: black;
            text-transform: uppercase;
            letter-spacing: -1px;
        }

        path {
            fill: none;
            stroke: black;
            stroke-width: 4;
            stroke-linecap: square;
            stroke-linejoin: miter;
        }

        button {
            padding: 10px 20px;
            background: #333;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <h1 style="margin-bottom: 20px;">KAIST ID Logo Generator</h1>

    <div class="controls">
        <input type="text" id="leftInput" placeholder="왼쪽 (아래) 텍스트" value="INDUSTRIAL">
        <input type="text" id="rightInput" placeholder="오른쪽 (위) 텍스트" value="DESIGN">
        <button onclick="downloadSVG()">SVG 저장</button>
        <button onclick="downloadPNG()">PNG 저장</button>
    </div>

    <div class="canvas-container">
        <svg id="logoSvg" width="600" height="300">
            <path id="logoPath" d="" />
            <text id="textLeft" font-size="50"></text>
            <text id="textRight" font-size="50"></text>
        </svg>
    </div>

    <script>
        const leftIn = document.getElementById('leftInput');
        const rightIn = document.getElementById('rightInput');
        const svgLeft = document.getElementById('textLeft');
        const svgRight = document.getElementById('textRight');
        const logoPath = document.getElementById('logoPath');
        const svg = document.getElementById('logoSvg');

        function draw() {
            try {
                // 1. 텍스트 업데이트
                svgLeft.textContent = leftIn.value;
                svgRight.textContent = rightIn.value;

                // 2. 좌표 및 크기 계산
                const startX = 50;
                const yTop = 100;    // 상단 선 높이
                const yBottom = 220; // 하단 선 높이
                const tickSize = 25; // 왼쪽 상단 틱 길이
                // const padding = 15;  // unused

                let leftWidth = 0;
                let rightWidth = 0;
                try {
                    leftWidth = svgLeft.getBBox().width;
                    rightWidth = svgRight.getBBox().width;
                } catch (e) {
                    console.warn("getBBox failed, defaulting to 100", e);
                    leftWidth = 100;
                    rightWidth = 100;
                }

                // 각 섹션의 가로 길이 (글자 길이에 맞춤)
                const section1Width = Math.max(leftWidth + 20, 100);
                const section2Width = Math.max(rightWidth + 20, 150);

                const x1 = startX;
                const x2 = x1 + section1Width;
                const x3 = x2 + section2Width;
                const radius = 60; // 곡선 반지름

                // 3. 텍스트 배치 (이미지 3, 4 스타일)
                // 왼쪽 텍스트: 하단 선(yBottom) 바로 아래
                svgLeft.setAttribute("x", x1);
                svgLeft.setAttribute("y", yBottom + 45);

                // 오른쪽 텍스트: 상단 선(yTop) 바로 위
                svgRight.setAttribute("x", x2 + 10);
                svgRight.setAttribute("y", yTop - 15);

                // 4. 경로(Path) 그리기
                // M: 이동, L: 선, A: 곡선
                const d = `
                    M ${x1 + tickSize}, ${yTop} 
                    L ${x1}, ${yTop} 
                    L ${x1}, ${yBottom} 
                    L ${x2}, ${yBottom} 
                    L ${x2}, ${yTop} 
                    L ${x3}, ${yTop} 
                    A ${radius},${radius} 0 0 1 ${x3}, ${yTop + radius * 2}
                    L ${x3 - 50}, ${yTop + radius * 2}
                `;

                logoPath.setAttribute("d", d);

                // SVG 캔버스 크기 조정
                svg.setAttribute("width", x3 + radius + 50);
                svg.setAttribute("height", yBottom + 150);
            } catch (err) {
                console.error("Draw loop error:", err);
            }
        }

        leftIn.addEventListener('input', draw);
        rightIn.addEventListener('input', draw);

        // Ensure fonts are loaded before measuring
        if (document.fonts) {
            document.fonts.ready.then(draw);
        } else {
            window.onload = draw;
        }

        function downloadSVG() {
            const svgData = getStyledSVG();
            const svgBlob = new Blob([svgData], { type: "image/svg+xml;charset=utf-8" });
            const svgUrl = URL.createObjectURL(svgBlob);
            const downloadLink = document.createElement("a");
            downloadLink.href = svgUrl;
            downloadLink.download = "kaist_logo.svg";
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        }

        function downloadPNG() {
            const svgData = getStyledSVG();
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();

            // Use the dimensions set in the draw function
            const w = parseFloat(svg.getAttribute('width'));
            const h = parseFloat(svg.getAttribute('height'));

            canvas.width = w;
            canvas.height = h;

            const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
            const url = URL.createObjectURL(svgBlob);

            img.onload = function () {
                ctx.drawImage(img, 0, 0);
                URL.revokeObjectURL(url);

                const pngUrl = canvas.toDataURL('image/png');
                const downloadLink = document.createElement('a');
                downloadLink.href = pngUrl;
                downloadLink.download = 'kaist_logo.png';
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
            };

            img.src = url;
        }

        function getStyledSVG() {
            let svgData = svg.outerHTML;
            // Inject XML namespace if missing (required for Blob -> Image)
            if (!svgData.includes('xmlns=')) {
                svgData = svgData.replace('<svg', '<svg xmlns="http://www.w3.org/2000/svg"');
            }
            // Inject styles explicitly so they appear in the exported file
            const style = `
                <style>
                    text { font-family: 'Helvetica Neue', sans-serif; font-weight: normal; fill: black; text-transform: uppercase; letter-spacing: -1px; }
                    path { fill: none; stroke: black; stroke-width: 4; stroke-linecap: square; stroke-linejoin: miter; }
                </style>
            `;
            return svgData.replace('>', '>' + style);
        }

        // Initial draw just in case
        draw();
    </script>
</body>

</html>
